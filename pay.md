# Pay

*Покупка в магазине*

Результатом выполнения запроса является перевод денежных средств с карты покупателя на счет магазина.

Клонируйте [шаблон процесса](https://www.corezoid.com/admin/edit_conv/27726/5060) для перевода денежных средств с карты покупателя на счет магазина..


![](../img/mandrill_copy_conveyor.png)

Вставьте Ваш `private key` из LiqPay в поле `Secret key`:
![](../img/api_secret_outer.png)

Сгенерируйте `callback URL` для возврата из LiqPay результатов платежа
![](../img/LiqPay_callback_url.png)

нажав на кнопку "Create callback url"
![](../img/LiqPay_callback_url_generate.png)

Вы получаете URL и в поле `Path to task_id` нужно указать значение `obj_id`
![](../img/LiqPay_callback_url_copy.png)

После чего скопировать URL и вставить его в поле `callback` логики API, который находится в zoid'е `Call api LiqPay`.
![](../img/LiqPay_callback_url_insert.png)

Перейдите в режим `dashboard` и нажмите кнопку `Add task` - чтобы добавить  заявку.

![](../img/mandrill_dashboard.png)

В открывщейся форме укажите параметры платежа и нажмите "Send task".

* `sandbox` **[optional]** - Включает тестовый режим для разработчиков. Деньги на карту не зачисляются. Чтобы включить тестовый режим, необходимо передать значение 1. Все тестовые платежи будут иметь статус sandbox - успешный тестовый платеж.
* `prepare` **[optional]** - Предподготовка платежа. Этот режим позволяет определить все ли данные заполнены, нужна ли 3DS проверка карты, не превышен ли лимит. Деньги с карты не списываются. Чтобы включить этот режим, необходимо передать значение 1.     
* `phone` **[required]** - Телефон плательщика. На этот номер будет отправлен OTP пароль подтверждения платежа. Телефон указывается в международном формате (Украина +380, Россия +7 ) 
* `amount` **[required]** - Сумма платежа. Например: 5, 7.34 
* `currency` **[required]** - Валюта платежа. Возможные значения: USD, EUR, RUB, UAH, GEL 
* `description` **[required]** - Описание платежа. 
* `order_id` **[required]** - Уникальный ID покупки в Вашем магазине. Максимальная длина - 255 символов. 
* `recurringbytoken` **[default 0]** - Этот параметр позволяет генерировать card_token плательщика, который вы получите в callback запросе на server_url. card_token позволяет проводить платежи в offline используя метод payment/paytoken. Услуга активируется через менеджера LiqPay. Возможные значения: 1
* `type` - Тип платежа. Возможные значения: buy - покупка; 
* `card` **[required]** - Номер карты плательщика 
* `card_exp_month` **[required]** - Месяц срока действия карты плательщика. Например: 08 
* `card_exp_year` **[required]** - Год срока действия карты плательщика. Например: 19 
* `card_cvv` **[required]** - CVV/CVV2 
* `server_url` **[optional]** - URL API в Вашем магазине для уведомлений о изменении статуса платежа (сервер->сервер). Максимальная длина - 510 символов. * `result_url` **[optional]** - URL в Вашем магазине на который покупатель будет переадресован после завершения покупки. Максимальная длина - 510 символов.
* `sender_first_name` **[optional]** - Имя отправителя
* `sender_last_name` **[optional]** - Фамилия отправителя
* `sender_country_code` **[optional]** - Страна отправителя. Цифровой ISO 3166-1 код
* `sender_city` **[optional]** - Город отправителя     
* `sender_address` **[optional]** - Адрес отправителя
* `sender_postal_code` **[optional]** - Почтовый индекс отправителя 
* `letter_of_credit` **[optional]** - Чтобы включить прием платежей по аккредитиву передайте параметр со значением 1     
* `letter_of_credit_date` **[optional]** - Дата окончания срока аккредитива. Передается в формате 2015-04-24 00:00:00     

![](../img/pay_task.png)

Далее нажмите кнопку `Send task` - отправить заявку.

**В случае успеха** в заявку будут добавлены параметры:
* **status**  - cтатус платежа:
 * `success` - успешный платеж
 * `failure` - неуспешный платеж
 * `otp_verify` - Требуется OTP подтверждение клиента. OTP пароль
   отправлен на номер телефона Клиента.
 * `3ds_verify` - Требуется 3DS верификация. Необходимо
   перенаправить Клиента по ссылке redirect_to
 * `wait_secure` - платеж на проверке
 * `wait_accept` - Деньги с клиента списаны, но магазин еще не
   прошел проверку
 * `wait_lc` - Аккредитив. Деньги с клиента списаны, ожидается
   подтверждение доставки товара
 * `processing` - Платеж обрабатывается.
 * `subscribed` - Подписка успешно оформлена
 * `unsubscribed` - Подписка успешно деактивирована
 * `sandbox` - тестовый платеж
 * `error` - Неуспешный платеж. Некорректно заполнены данные
* **token** - token, требуется для завершения платежа при OTP верификации Клиента     

**В случае ошибки** заявка перейдет в узел эскалации с параметром:
* **err_code** - Код ошибки.     
* **err_description** - Описание ошибки   


